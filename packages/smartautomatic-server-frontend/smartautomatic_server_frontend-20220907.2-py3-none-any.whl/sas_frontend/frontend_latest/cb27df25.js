"use strict";(self.webpackChunksmartautomatic_server_frontend=self.webpackChunksmartautomatic_server_frontend||[]).push([[55424],{92306:(t,e,n)=>{n.d(e,{v:()=>s});const s=(t,e)=>{const n={};for(const s of t){const t=e(s);t in n?n[t].push(s):n[t]=[s]}return n}},11950:(t,e,n)=>{n.d(e,{l:()=>s});const s=async(t,e)=>new Promise((n=>{const s=e(t,(t=>{s(),n(t)}))}))},81582:(t,e,n)=>{n.d(e,{LZ:()=>s,Q4:()=>r,pB:()=>i,SO:()=>o,iJ:()=>a,Nn:()=>_,Ny:()=>c,T0:()=>u});const s=["migration_error","setup_error","setup_retry"],r=["not_loaded","loaded","setup_error","setup_retry"],i=(t,e)=>{const n={};return e&&(e.type&&(n.type_filter=e.type),e.domain&&(n.domain=e.domain)),t.callWS({type:"config_entries/get",...n})},o=(t,e,n)=>t.callWS({type:"config_entries/update",entry_id:e,...n}),a=(t,e)=>t.callApi("DELETE",`config/config_entries/entry/${e}`),_=(t,e)=>t.callApi("POST",`config/config_entries/entry/${e}/reload`),c=(t,e)=>t.callWS({type:"config_entries/disable",entry_id:e,disabled_by:"user"}),u=(t,e)=>t.callWS({type:"config_entries/disable",entry_id:e,disabled_by:null})},55424:(t,e,n)=>{n.a(t,(async t=>{n.d(e,{Bm:()=>b,o1:()=>v,iK:()=>w,rl:()=>T,P:()=>W,KU:()=>Z,xZ:()=>O,gy:()=>k,ZC:()=>E,_Z:()=>j,Jj:()=>C,yH:()=>I,UB:()=>D,jB:()=>L,gM:()=>N,yT:()=>B,_n:()=>H,vR:()=>K,vE:()=>z});var s=n(4535),r=n(59699),i=n(32182),o=n(79021),a=n(39244),_=n(27088),c=n(83008),u=n(70390),l=n(47538),y=n(64218),m=n(92306),d=n(11950),f=n(81582),p=n(74186),g=n(58763),h=t([g]);g=(h.then?await h:h)[0];const S=[],b=()=>({stat_energy_from:"",stat_cost:null,entity_energy_from:null,entity_energy_price:null,number_energy_price:null}),v=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_to:null,entity_energy_price:null,number_energy_price:null}),w=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),T=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),W=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),Z=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_from:null,entity_energy_price:null,number_energy_price:null}),O=t=>t.callWS({type:"energy/info"}),k=t=>t.callWS({type:"energy/validate"}),E=t=>t.callWS({type:"energy/get_prefs"}),j=async(t,e)=>{const n=t.callWS({type:"energy/save_prefs",...e});return M(t),n},P=async(t,e,n,s,r,i="hour")=>t.callWS({type:"energy/fossil_energy_consumption",start_time:e.toISOString(),end_time:null==r?void 0:r.toISOString(),energy_statistic_ids:n,co2_statistic_id:s,period:i}),C=t=>(0,m.v)(t.energy_sources,(t=>t.type)),I=(t,e)=>{const n=[];for(const s of t.energy_sources)if("solar"!==s.type)if("gas"!==s.type)if("battery"!==s.type){for(const t of s.flow_from){n.push(t.stat_energy_from),t.stat_cost&&n.push(t.stat_cost);const s=e.cost_sensors[t.stat_energy_from];s&&n.push(s)}for(const t of s.flow_to){n.push(t.stat_energy_to),t.stat_compensation&&n.push(t.stat_compensation);const s=e.cost_sensors[t.stat_energy_to];s&&n.push(s)}}else n.push(s.stat_energy_from),n.push(s.stat_energy_to);else{n.push(s.stat_energy_from),s.stat_cost&&n.push(s.stat_cost);const t=e.cost_sensors[s.stat_energy_from];t&&n.push(t)}else n.push(s.stat_energy_from);return n},M=t=>{S.forEach((e=>{const n=D(t,{key:e});n.clearPrefs(),n._active&&n.refresh()}))},D=(t,e={})=>{let n="_energy";if(e.key){if(!e.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n=`_${e.key}`}if(t.connection[n])return t.connection[n];S.push(e.key);const m=(0,y._)(t.connection,n,(async()=>{if(m.prefs||(m.prefs=await E(t)),m._refreshTimeout&&clearTimeout(m._refreshTimeout),m._active&&(!m.end||m.end>new Date)){const t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),m._refreshTimeout=window.setTimeout((()=>m.refresh()),t.getTime()-Date.now())}return(async(t,e,n,_,c)=>{const[u,l,y]=await Promise.all([(0,f.pB)(t,{domain:"co2signal"}),(0,d.l)(t.connection,p.LM),O(t)]),m=u.length?u[0]:void 0;let h;if(m)for(const e of l){if(e.config_entry_id!==m.entry_id)continue;const n=t.states[e.entity_id];if(n&&"%"===n.attributes.unit_of_measurement){h=n.entity_id;break}}const S=[];for(const t of e.energy_sources)if("grid"===t.type)for(const e of t.flow_from)S.push(e.stat_energy_from);const b=I(e,y),v=(0,s.Z)(_||new Date,n),w=v>35?"month":v>2?"day":"hour",T=(0,r.Z)(n,-1),W=await(0,g.dL)(t,T,_,b,w);let Z,k,E,j,C;if(c){k=v>27&&v<32?(0,i.Z)(n,-1):(0,o.Z)(n,-1*(v+1));const e=(0,r.Z)(k,-1);E=(0,a.Z)(n,-1),Z=await(0,g.dL)(t,e,E,b,w)}void 0!==h&&(j=await P(t,n,S,h,_,v>35?"month":v>2?"day":"hour"),c&&(C=await P(t,k,S,h,E,v>35?"month":v>2?"day":"hour"))),Object.values(W).forEach((t=>{t.length&&new Date(t[0].start)>T&&t.unshift({...t[0],start:T.toISOString(),end:T.toISOString(),sum:0,state:0})}));const M=await(0,g.Py)(t,b),D={};return M.forEach((t=>{D[t.statistic_id]=t})),{start:n,end:_,startCompare:k,endCompare:E,info:y,prefs:e,stats:W,statsMetadata:D,statsCompare:Z,co2SignalConfigEntry:m,co2SignalEntity:h,fossilEnergyConsumption:j,fossilEnergyConsumptionCompare:C}})(t,m.prefs,m.start,m.end,m.compare)})),h=m.subscribe;m.subscribe=t=>{const e=h(t);return m._active++,()=>{m._active--,m._active<1&&(clearTimeout(m._refreshTimeout),m._refreshTimeout=void 0),e()}},m._active=0,m.prefs=e.prefs;const b=new Date;m.start=b.getHours()>0?(0,_.Z)():(0,c.Z)(),m.end=b.getHours()>0?(0,u.Z)():(0,l.Z)();const v=()=>{m._updatePeriodTimeout=window.setTimeout((()=>{m.start=(0,_.Z)(),m.end=(0,u.Z)(),v()}),(0,r.Z)((0,u.Z)(),1).getTime()-Date.now())};return v(),m.clearPrefs=()=>{m.prefs=void 0},m.setPeriod=(t,e)=>{var n;m.start=t,m.end=e,m.start.getTime()!==(0,_.Z)().getTime()||(null===(n=m.end)||void 0===n?void 0:n.getTime())!==(0,u.Z)().getTime()||m._updatePeriodTimeout?m._updatePeriodTimeout&&(clearTimeout(m._updatePeriodTimeout),m._updatePeriodTimeout=void 0):v()},m.setCompare=t=>{m.compare=t},m},L=t=>t.callWS({type:"energy/solar_forecast"}),N=["mÂ³"],B=["kWh"],H=[...N,...B],K=(t,e={},n)=>{for(const s of t.energy_sources){if("gas"!==s.type)continue;if(n&&n===s.stat_energy_from)continue;const t=e[s.stat_energy_from];if(t)return N.includes(t.display_unit_of_measurement)?"volume":"energy"}},z=(t,e={})=>{for(const n of t.energy_sources){if("gas"!==n.type)continue;const t=e[n.stat_energy_from];if(null!=t&&t.display_unit_of_measurement)return t.display_unit_of_measurement}}}))},58763:(t,e,n)=>{n.a(t,(async t=>{n.d(e,{iq:()=>u,vq:()=>l,MG:()=>y,iz:()=>m,Nu:()=>p,uR:()=>g,Py:()=>h,dL:()=>S,h_:()=>b,Cj:()=>v,hN:()=>w,Kj:()=>T,q6:()=>W,Nw:()=>Z,j2:()=>O,Kd:()=>k});var s=n(58831),r=n(29171),i=n(91741),o=t([r]);r=(o.then?await o:o)[0];const a=["climate","humidifier","water_heater"],_=["climate","humidifier","input_datetime","thermostat","water_heater"],c=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode"],u=(t,e)=>!t.states[e]||_.includes((0,s.M)(e)),l=(t,e,n,s,r=!1,i,o=!0,a)=>{let _="history/period";return n&&(_+="/"+n.toISOString()),_+="?filter_entity_id="+e,s&&(_+="&end_time="+s.toISOString()),r&&(_+="&skip_initial_state"),void 0!==i&&(_+=`&significant_changes_only=${Number(i)}`),o&&(_+="&minimal_response"),a&&(_+="&no_attributes"),t.callApi("GET",_)},y=(t,e,n,s,r=!1,i,o=!0,a)=>t.callWS({type:"history/history_during_period",start_time:n.toISOString(),end_time:s.toISOString(),significant_changes_only:i||!1,include_start_time_state:!r,minimal_response:o,no_attributes:a||!1,entity_ids:e.split(",")}),m=(t,e,n,s)=>{const r={type:"history/history_during_period",start_time:e.toISOString(),end_time:n.toISOString(),minimal_response:!0,no_attributes:!s.map((e=>u(t,e))).reduce(((t,e)=>t||e),!1)};return 0!==s.length?t.callWS({...r,entity_ids:s}):t.callWS(r)},d=(t,e)=>t.state===e.state&&(!t.attributes||!e.attributes||c.every((n=>t.attributes[n]===e.attributes[n]))),f=t=>"unit_of_measurement"in t||"state_class"in t,p=(t,e,n)=>{const o={},_=[];if(!e)return{line:[],timeline:[]};Object.keys(e).forEach((a=>{const c=e[a];if(0===c.length)return;const u=a in t.states?t.states[a]:void 0,l=!u&&c.find((t=>t.a&&f(t.a)));let y;y=u&&f(u.attributes)?u.attributes.unit_of_measurement||" ":l?l.a.unit_of_measurement||" ":{zone:n("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,counter:"#",humidifier:"%",input_number:"#",number:"#",water_heater:t.config.unit_system.temperature}[(0,s.M)(a)],y?y in o&&a in o[y]?o[y][a].push(...c):(y in o||(o[y]={}),o[y][a]=c):_.push(((t,e,n,s,o)=>{const a=[],_=s[0];for(const i of s)a.length>0&&i.s===a[a.length-1].state||a.push({state_localize:(0,r.c)(t,e,n,i.a||_.a,i.s),state:i.s,last_changed:1e3*(i.lc?i.lc:i.lu)});return{name:(0,i.a)(n,(null==o?void 0:o.attributes)||_.a),entity_id:n,data:a}})(n,t.locale,a,c,u))}));return{line:Object.keys(o).map((e=>((t,e,n)=>{const r=[];return Object.keys(e).forEach((t=>{const o=e[t],_=o[0],u=(0,s.M)(t),l=[];for(const t of o){let e;if(a.includes(u)){e={state:t.s,last_changed:1e3*t.lu,attributes:{}};for(const n of c)n in t.a&&(e.attributes[n]=t.a[n])}else e={state:t.s,last_changed:1e3*(t.lc?t.lc:t.lu),attributes:{}};l.length>1&&d(e,l[l.length-1])&&d(e,l[l.length-2])||l.push(e)}const y=t in n?n[t].attributes:"friendly_name"in _.a?_.a:void 0;r.push({domain:u,name:(0,i.a)(t,y||{}),entity_id:t,states:l})})),{unit:t,identifier:Object.keys(e).join(""),data:r}})(e,o[e],t.states))),timeline:_}},g=(t,e)=>t.callWS({type:"history/list_statistic_ids",statistic_type:e}),h=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),S=(t,e,n,s,r="hour")=>t.callWS({type:"history/statistics_during_period",start_time:e.toISOString(),end_time:null==n?void 0:n.toISOString(),statistic_ids:s,period:r}),b=t=>t.callWS({type:"recorder/validate_statistics"}),v=(t,e,n)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:n}),w=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),T=t=>{if(!t||t.length<2)return null;const e=t[t.length-1].sum;if(null===e)return null;const n=t[0].sum;return null===n?e:e-n},W=(t,e)=>{let n=null;for(const s of e){if(!(s in t))continue;const e=T(t[s]);null!==e&&(null===n?n=e:n+=e)}return n},Z=(t,e)=>t.some((t=>null!==t[e])),O=(t,e,n,s)=>t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:n,adjustment:s}),k=(t,e,n)=>{const s=t.states[e];return s?(0,i.C)(s):(null==n?void 0:n.name)||e}}))}}]);