import{m as C,g as N,T as I,n as i,o as d,p as m,i as l,Y as a,l as c,u as G,h as E,Q as F,Z as v,P as O,_ as S}from"./main.d4a418fc.js";import{a7 as r,B as x,aC as p,aD as M,aE as A,a as n,aF as K,f as V,aG as H,C as W,aH as z,aI as Y,aJ as j,aK as U,aL as q,j as f,t as Q,_ as u,q as X,O as T,S as J,aM as Z,aN as ee,ap as te,ae as w,Q as k,U as se,aO as oe,aP as ae,aQ as ne}from"./button.8da8748a.js";import{S as re,_ as R,a as $,g as ie,P as le}from"./metadata-dialog.4b4078cb.js";const ue=C(x,r),y=ue.extend({name:"v-radio-group",provide(){return{radioGroup:this}},props:{column:{type:Boolean,default:!0},height:{type:[Number,String],default:"auto"},name:String,row:Boolean,value:null},computed:{classes(){return{...r.options.computed.classes.call(this),"v-input--selection-controls v-input--radio-group":!0,"v-input--radio-group--column":this.column&&!this.row,"v-input--radio-group--row":this.row}}},methods:{genDefaultSlot(){return this.$createElement("div",{staticClass:"v-input--radio-group__input",attrs:{id:this.id,role:"radiogroup","aria-labelledby":this.computedId}},r.options.methods.genDefaultSlot.call(this))},genInputSlot(){const t=r.options.methods.genInputSlot.call(this);return delete t.data.on.click,t},genLabel(){const t=r.options.methods.genLabel.call(this);return t?(t.data.attrs.id=this.computedId,delete t.data.attrs.for,t.tag="legend",t):null},onClick:x.options.methods.onClick},render(t){const e=r.options.render.call(this,t);return this._b(e.data,"div",this.attrs$),e}});const ce=C(z,W,H,V("radioGroup"),I),_=ce.extend().extend({name:"v-radio",inheritAttrs:!1,props:{disabled:Boolean,id:String,label:String,name:String,offIcon:{type:String,default:"$radioOff"},onIcon:{type:String,default:"$radioOn"},readonly:Boolean,value:{default:null}},data:()=>({isFocused:!1}),computed:{classes(){return{"v-radio--is-disabled":this.isDisabled,"v-radio--is-focused":this.isFocused,...this.themeClasses,...this.groupClasses}},computedColor(){if(!this.isDisabled)return p.options.computed.computedColor.call(this)},computedIcon(){return this.isActive?this.onIcon:this.offIcon},computedId(){return r.options.computed.computedId.call(this)},hasLabel:r.options.computed.hasLabel,hasState(){return(this.radioGroup||{}).hasState},isDisabled(){return this.disabled||!!this.radioGroup&&this.radioGroup.isDisabled},isReadonly(){return this.readonly||!!this.radioGroup&&this.radioGroup.isReadonly},computedName(){return this.name||!this.radioGroup?this.name:this.radioGroup.name||`radio-${this.radioGroup._uid}`},rippleState(){return p.options.computed.rippleState.call(this)},validationState(){return(this.radioGroup||{}).validationState||this.computedColor}},methods:{genInput(t){return p.options.methods.genInput.call(this,"radio",t)},genLabel(){return this.hasLabel?this.$createElement(M,{on:{click:A},attrs:{for:this.computedId},props:{color:this.validationState,focused:this.hasState}},N(this,"label")||this.label):null},genRadio(){const{title:t,...e}=this.attrs$;return this.$createElement("div",{staticClass:"v-input--selection-controls__input"},[this.$createElement(n,this.setTextColor(this.validationState,{props:{dense:this.radioGroup&&this.radioGroup.dense}}),this.computedIcon),this.genInput({name:this.computedName,value:this.value,...e}),this.genRipple(this.setTextColor(this.rippleState))])},onFocus(t){this.isFocused=!0,this.$emit("focus",t)},onBlur(t){this.isFocused=!1,this.$emit("blur",t)},onChange(){this.isDisabled||this.isReadonly||this.isActive||this.toggle()},onKeydown:()=>{}},render(t){const e={staticClass:"v-radio",class:this.classes,on:K({click:this.onChange},this.listeners$),attrs:{title:this.attrs$.title}};return t("div",e,[this.genRadio(),this.genLabel()])}});const de={data(){return{mdiMenuLeft:Y,mdiMenuRight:j,mdiKeyboardSpace:U,mdiAppleKeyboardShift:q}},methods:{isMobile:function(){return typeof window.orientation<"u"||navigator.userAgent.includes("IEMobile")}}};var pe=function(){var e=this,s=e._self._c;return e.isMobile()?e._e():s("div",{attrs:{id:"readerKeyboardShortcutsDialog"}},[s("h3",[e._v("Keyboard Shortcuts")]),s("table",{staticClass:"highlight-table",attrs:{id:"readerKeyboardShortcutsTable"}},[s("tbody",[s("tr",[s("td",[s(n,{attrs:{color:"grey"}},[e._v(" "+e._s(e.mdiMenuLeft)+" ")]),e._v(" j"),s("br"),s(n,{attrs:{color:"grey",dense:""}},[e._v(" "+e._s(e.mdiAppleKeyboardShift)+" ")]),s(n,{attrs:{color:"grey",dense:""}},[e._v(" "+e._s(e.mdiKeyboardSpace)+" ")])],1),s("td",[e._v("Previous page")])]),s("tr",[s("td",[s(n,{attrs:{color:"grey"}},[e._v(" "+e._s(e.mdiMenuRight)+" ")]),e._v("k"),s("br"),s(n,{attrs:{color:"grey",dense:""}},[e._v(" "+e._s(e.mdiKeyboardSpace)+" ")])],1),s("td",[e._v("Next page")])]),e._m(0),e._m(1),e._m(2),e._m(3),e._m(4),e._m(5),e._m(6)])])])},_e=[function(){var t=this,e=t._self._c;return e("tr",[e("td",[t._v("h")]),e("td",[t._v("Fit page to screen height")])])},function(){var t=this,e=t._self._c;return e("tr",[e("td",[t._v("w")]),e("td",[t._v("Fit page to screen width")])])},function(){var t=this,e=t._self._c;return e("tr",[e("td",[t._v("s")]),e("td",[t._v("Fit page to screen")])])},function(){var t=this,e=t._self._c;return e("tr",[e("td",[t._v("o")]),e("td",[t._v("Show page at original size")])])},function(){var t=this,e=t._self._c;return e("tr",[e("td",[t._v("2")]),e("td",[t._v("Toggle two page view")])])},function(){var t=this,e=t._self._c;return e("tr",[e("td",[t._v("m")]),e("td",[t._v("Show comic's metadata")])])},function(){var t=this,e=t._self._c;return e("tr",[e("td",[t._v("c")]),e("td",[t._v("Close book")])])}],ge=i(de,pe,_e,!1,null,"c7794298",null,null);const he=ge.exports;const me={name:"ReaderSettingsPanel",components:{ReaderKeyboardShortcutsPanel:he,SettingsCommonPanel:re},data(){return{isSettingsDialogGlobalMode:!1}},computed:{...d(m,["isCodexViewable"]),...l(a,{fitToChoices:t=>t.choices.fitTo,settingsScope:function(t){return this.isSettingsDialogGlobalMode?t.settings.globl:t.settings.local}}),isSettingsDrawerOpen:{get(){return a().isSettingsDrawerOpen},set(t){a().isSettingsDrawerOpen=t}},isClearSettingsButtonDisabled:function(){return this.isSettingsDialogGlobalMode||(this.settingsScope.twoPages===null||this.settingsScope.twoPages===void 0)&&(this.settingsScope.fitTo===null||this.settingsScope.fitTo===void 0)}},mounted(){window.addEventListener("keyup",this._keyListener),this.$emit("panelMounted")},beforeDestroy:function(){window.removeEventListener("keyup",this._keyListener)},methods:{...c(a,["clearSettingsLocal","setSettingsGlobal","setSettingsLocal"]),settingsDialogChanged:function(t){this.isSettingsDialogGlobalMode?this.setSettingsGlobal(t):this.setSettingsLocal(t)},_keyListener:function(t){switch(t.stopPropagation(),t.key){case"w":this.setSettingsLocal({fitTo:"WIDTH"});break;case"h":this.setSettingsLocal({fitTo:"HEIGHT"});break;case"s":this.setSettingsLocal({fitTo:"SCREEN"});break;case"o":this.setSettingsLocal({fitTo:"ORIG"});break;case"2":this.setSettingsLocal({twoPages:!this.settingsScope.twoPages});break}}}};var ve=function(){var e=this,s=e._self._c;return s(f,{attrs:{id:"readerSettingsDrawer",app:"",right:"",temporary:"",touchless:""},model:{value:e.isSettingsDrawerOpen,callback:function(o){e.isSettingsDrawerOpen=o},expression:"isSettingsDrawerOpen"}},[e.isCodexViewable?s("div",[s("div",{attrs:{id:"readerSettings"}},[s("h3",[e._v("Reader Settings")]),s(y,{attrs:{label:"Scope"},model:{value:e.isSettingsDialogGlobalMode,callback:function(o){e.isSettingsDialogGlobalMode=o},expression:"isSettingsDialogGlobalMode"}},[s(_,{attrs:{label:"Only this comic",value:!1}}),s(_,{attrs:{label:"Default for all comics",value:!0}})],1),s(y,{staticClass:"displayRadioGroup",attrs:{label:"Display",value:e.settingsScope.fitTo},on:{change:function(o){return e.settingsDialogChanged({fitTo:o})}}},e._l(e.fitToChoices,function(o){return s(_,{key:o.value,attrs:{label:o.text,value:o.value}})}),1),s(Q,{staticClass:"displayTwoPages",attrs:{label:"Two pages",value:e.settingsScope.twoPages,indeterminate:e.settingsScope.twoPages===null||e.settingsScope.twoPages===void 0,ripple:""},on:{change:function(o){return e.settingsDialogChanged({twoPages:o===!0})}}}),s(u,{attrs:{disabled:e.isClearSettingsButtonDisabled,title:"Use the default settings for all comics for this comic"},on:{click:e.clearSettingsLocal}},[e._v(" Clear Comic Settings ")])],1),s(X),s("ReaderKeyboardShortcutsPanel")],1):e._e(),s("SettingsCommonPanel")],1)},fe=[],be=i(me,ve,fe,!1,null,"ecec2cbe",null,null);const D=be.exports;const Se={name:"ReaderNavButton",props:{value:{type:Number,required:!0}},computed:{toRoute:function(){const t={...this.$route.params};return t.page=this.value,{name:this.$route.name,params:t}},disabled:function(){return this.$route.params.page===this.value}}};var we=function(){var e=this,s=e._self._c;return s(u,{staticClass:"readerNavButton",attrs:{disabled:e.disabled,to:e.toRoute,ripple:"",large:""}},[e._v(" "+e._s(e.value)+" ")])},ke=[],ye=i(Se,we,ke,!1,null,"62214495",null,null);const b=ye.exports;const Pe={name:"ReaderNavToolbar",components:{PaginationSlider:R,ReaderNavButton:b},computed:{...l(a,{maxPage:t=>t.comic.maxPage})},methods:{...c(a,["routeToPage"])}};var Ce=function(){var e=this,s=e._self._c;return e.maxPage?s(T,{staticClass:"readerNavToolbar",attrs:{dense:"",transform:"center bottom"}},[s(b,{attrs:{value:0}}),s(R,{attrs:{value:+e.$route.params.page,min:0,max:e.maxPage},on:{change:function(o){return e.routeToPage(o)}}}),s(b,{attrs:{value:e.maxPage}})],1):e._e()},xe=[],Te=i(Pe,Ce,xe,!1,null,"a9938c2b",null,null);const L=Te.exports;const Re={name:"ReaderTitleToolbar",components:{MetadataDialog:$,SettingsDrawerButton:J},data(){return{mdiClose:Z,mdiFileImage:ee}},head(){const t=this.$route.params.page,e=`read ${this.title} page ${t}`;return{meta:[{hid:"description",name:"description",content:e}]}},computed:{...l(a,{title:function(t){return ie(t.comic)},timestamp:t=>t.timestamp,seriesPosition:function(t){if(t.routes.seriesCount>1)return`${t.routes.seriesIndex}/${t.routes.seriesCount}`}}),...l(G,{lastRoute:t=>t.page.routes.last}),...E(a,["isSettingsDrawerOpen"]),...d(a,["computedSettings"]),closeBookRoute:function(){const t={name:"browser",params:this.lastRoute};return t.params?t.hash=`#card-${this.$route.params.pk}`:t.params=window.CODEX.LAST_ROUTE||F.browser.route,t},pageSrc:function(){const t={...this.$router.currentRoute.params};return v(t,this.timestamp)},pageName:function(){const t=this.$router.currentRoute.params.page;return`${this.title} - page ${t}.jpg`}},mounted(){window.addEventListener("keyup",this._keyListener)},beforeDestroy:function(){window.removeEventListener("keyup",this._keyListener)},methods:{...c(te,["downloadIOSPWAFix"]),openMetadata:function(){this.$refs.metadataDialog.dialog=!0},_keyListener:function(t){t.stopPropagation(),t.key==="c"?this.$refs.closeBook.$el.click():t.key==="m"&&this.openMetadata()},download(){this.downloadIOSPWAFix(this.pageSrc,this.pageName)}}};var $e=function(){var e=this,s=e._self._c;return s(T,{attrs:{id:"readerTopToolbar",dense:""}},[s(w,[s(u,{ref:"closeBook",attrs:{id:"closeBook",to:e.closeBookRoute,large:"",ripple:""}},[e.$vuetify.breakpoint.mobile?s(n,[e._v(" "+e._s(e.mdiClose)+" ")]):s("span",[e._v("close book")])],1)],1),s(k),s(se,{attrs:{id:"toolbarTitle"}},[e._v(" "+e._s(e.title)+" ")]),s(k),e.seriesPosition?s("span",{attrs:{id:"seriesPosition"}},[e._v(e._s(e.seriesPosition))]):e._e(),s(w,[s(u,{attrs:{id:"tagButton"},on:{click:function(o){return o.stopPropagation(),e.openMetadata.apply(null,arguments)}}},[s($,{ref:"metadataDialog",attrs:{group:"c",pk:Number(e.$router.currentRoute.params.pk)}})],1),s(u,{attrs:{id:"downloadPageButton",title:"Download Page"},on:{click:e.download}},[s(n,[e._v(e._s(e.mdiFileImage))])],1),s("SettingsDrawerButton",{attrs:{id:"settingsButton"},on:{click:function(o){o.stopPropagation(),e.isSettingsDrawerOpen=!0}}})],1)],1)},De=[],Le=i(Re,$e,De,!1,null,"5e2a0c61",null,null);const B=Le.exports;const g="prev",h="next",Be={name:"ReaderNavOverlay",data(){return{mdiBookArrowRight:oe}},computed:{...l(a,{routes:t=>t.routes,bookChangePrev:t=>t.bookChange===g,bookChangeNext:t=>t.bookChange===h}),routePrevPage:function(){return this.toRoute("prev")},routeNextPage:function(){return this.toRoute("next")},routePrevBook:function(){return this.toRoute("prevBook")},routeNextBook:function(){return this.toRoute("nextBook")}},mounted(){window.addEventListener("keyup",this._keyListener)},beforeDestroy:function(){window.removeEventListener("keyup",this._keyListener)},methods:{...c(a,["routeToDirection","setBookChangeFlag"]),toRoute:function(t){const e=this.routes[t];return e?{name:"reader",params:e}:!1},_keyListener:function(t){switch(t.key){case" ":!t.shiftKey&&window.innerHeight+window.scrollY>=document.body.scrollHeight&&this.routes.next?this.routeToDirection(h):!!t.shiftKey&&window.scrollY===0&&this.routes.prev&&this.routeToDirection(g);break;case"j":case"ArrowRight":this.routeToDirection(h);break;case"k":case"ArrowLeft":this.routeToDirection(g);break}}}};var Ne=function(){var e=this,s=e._self._c;return s("nav",{attrs:{id:"navColumns"}},[!e.routePrevPage&&e.routePrevBook?s(f,{staticClass:"bookChangeDrawer",attrs:{id:"prevBookDrawer",absolute:"",left:"",temporarary:"",value:e.bookChangePrev}},[s("router-link",{staticClass:"navLink",attrs:{to:e.routePrevBook,"aria-label":"previous book"}},[s(n,{staticClass:"bookChangeIcon flipped",attrs:{"x-large":""}},[e._v(" "+e._s(e.mdiBookArrowRight)+" ")])],1)],1):e._e(),s("section",{staticClass:"navColumn",attrs:{id:"leftColumn"},on:{click:function(o){o.stopPropagation()}}},[e.routePrevPage?s("router-link",{staticClass:"navLink",attrs:{id:"navLinkPrev",to:e.routePrevPage,"aria-label":"previous page"}}):e.routePrevBook?s("div",{staticClass:"drawerButton",attrs:{id:"navLinkPrev"},on:{click:function(o){return e.setBookChangeFlag("prev")}}}):e._e()],1),s("section",{attrs:{id:"middleColumn"},on:{click:function(o){return e.setBookChangeFlag(null)}}}),s("section",{staticClass:"navColumn",attrs:{id:"rightColumn"},on:{click:function(o){o.stopPropagation()}}},[e.routeNextPage?s("router-link",{staticClass:"navLink",attrs:{id:"navLinkNext",to:e.routeNextPage,"aria-label":"next page"}}):e.routeNextBook?s("div",{staticClass:"drawerButton",attrs:{id:"navLinkNext"},on:{click:function(o){return o.stopPropagation(),e.setBookChangeFlag("next")}}}):e._e()],1),!e.routeNextPage&&e.routeNextBook?s(f,{staticClass:"bookChangeDrawer",attrs:{id:"nextBookDrawer",absolute:"",right:"",temporarary:"",value:e.bookChangeNext}},[s("router-link",{staticClass:"navLink",attrs:{to:e.routeNextBook,"aria-label":"next book"},nativeOn:{click:function(o){o.stopPropagation()}}},[s(n,{staticClass:"bookChangeIcon",attrs:{"x-large":""}},[e._v(" "+e._s(e.mdiBookArrowRight)+" ")])],1)],1):e._e()],1)},Ie=[],Ge=i(Be,Ne,Ie,!1,null,"ea73b4ac",null,null);const Ee=Ge.exports;const Fe=()=>O(()=>import("./vue2-pdf-embed.599a1e5e.js").then(t=>t.v),["assets/vue2-pdf-embed.599a1e5e.js","assets/main.d4a418fc.js","assets/main.737b062e.css"]),P=500,Oe={name:"ReaderPage",components:{Placeholder:le,VuePdfEmbed:Fe},props:{pageIncrement:{type:Number,required:!0}},data(){return{page:0,loaded:0}},head(){if(this.displayPage&&this.nextRoute)return{link:[{rel:"prefetch",as:"image",href:this.nextSrc}]}},computed:{...l(a,{maxPage:t=>t.comic.maxPage,nextRoute:t=>t.routes.next,timestamp:t=>t.timestamp,isPDF:t=>t.comic.fileFormat==="pdf"}),...d(a,["computedSettings"]),displayPage(){return(this.pageIncrement===0||this.computedSettings.twoPages)&&this.page<=this.maxPage&&this.page>=0},placeholderSize(){const t=Math.min(window.innerHeight,window.innerWidth);return Number.parseInt(t/2)},src(){const t={...this.$router.currentRoute.params};return t.page=this.page,v(t,this.timestamp)},nextSrc(){const t={...this.nextRoute};return t.page=this.nextRoute.page+this.pageIncrement,v(t,this.timestamp)},alt(){return`Page ${this.page}`},fitToClass(){let t={page:!0};const e=this.computedSettings.fitTo;if(e){let s="fitTo";s+=e.charAt(0).toUpperCase(),s+=e.slice(1).toLowerCase(),this.computedSettings.twoPages&&(s+="Two"),t[s]=!0}return t},pdfWidth(){const t=this.computedSettings.fitTo;let e=0;return["WIDTH","ORIG"].includes(t)&&(e=window.innerWidth),e&&this.computedSettings.twoPages&&(e=e/2),e},pdfHeight(){const t=this.computedSettings.fitTo;return["HEIGHT","SCREEN","ORIG"].includes(t)?window.innerHeight:0},pdfKey(){return`${this.computedSettings.fitTo}${this.computedSettings.twoPages}`}},watch:{$route:function(){this.setPage()}},created:function(){this.setPage()},methods:{setPage:function(){setTimeout(()=>{Date.now()-this.loaded>P&&(this.loaded=0)},P),this.page=Number(this.$router.currentRoute.params.page)+this.pageIncrement},imgLoaded:function(){this.loaded=Date.now()}}};var Me=function(){var e=this,s=e._self._c;return e.displayPage?s("div",{attrs:{id:e.page}},[s("Placeholder",{staticClass:"placeholder",class:{hidden:e.loaded},attrs:{size:e.placeholderSize}}),e.isPDF?s("vue-pdf-embed",{key:e.pdfKey,class:e.fitToClass,attrs:{source:e.src,page:1,width:e.pdfWidth,height:e.pdfHeight,"disable-annotation-layer":!0,"disable-text-layer":!0},on:{load:e.imgLoaded}}):s("img",{class:e.fitToClass,attrs:{src:e.src,alt:e.alt},on:{load:e.imgLoaded}})],1):e._e()},Ae=[],Ke=i(Oe,Me,Ae,!1,null,"d2d1913c",null,null);const Ve=Ke.exports;const He={name:"MainReader",components:{ReaderPage:Ve,ReaderNavOverlay:Ee,ReaderNavToolbar:L,ReaderTitleToolbar:B,ReaderSettingsDrawer:D},data(){return{showToolbars:!1}},computed:{...l(m,{user:t=>t.user}),...d(m,["isCodexViewable"]),touchMap:function(){return this.$vuetify.breakpoint.mobile?{}:{left:()=>this.routeTo("next"),right:()=>this.routeTo("prev")}}},watch:{$route(t,e){!e.params||Number(t.params.pk)!==Number(e.params.pk)?this.loadBook():this.setRoutesAndBookmarkPage(),window.scrollTo(0,0)},user:function(){this.loadReaderSettings()},isCodexViewable:function(){this.loadReaderSettings()}},created(){this.loadReaderSettings(),this.loadBook()},methods:{...c(a,["loadBook","loadReaderSettings","routeTo","setRoutesAndBookmarkPage"]),toggleToolbars:function(){this.showToolbars=!this.showToolbars}}};var We=function(){var e=this,s=e._self._c;return s("div",[s(S,{attrs:{id:"readerWrapper"}},[e.isCodexViewable?s("div",{attrs:{id:"readerContainer"}},[s(S,[s("div",{attrs:{id:"pagesContainer"}},[s("ReaderPage",{attrs:{"page-increment":0}}),s("ReaderPage",{attrs:{"page-increment":1}})],1),s("div",{attrs:{id:"navOverlay","v-touch":e.touchMap},on:{click:e.toggleToolbars}},[s("ReaderNavOverlay")],1)]),s(ae,[s(B,{directives:[{name:"show",rawName:"v-show",value:e.showToolbars,expression:"showToolbars"}]})],1),s(ne,[s(L,{directives:[{name:"show",rawName:"v-show",value:e.showToolbars,expression:"showToolbars"}]})],1)],1):s("div",{attrs:{id:"announcement"}},[s("h1",[s("router-link",{attrs:{to:{name:"home"}}},[e._v(" Log in ")]),e._v(" to read comics ")],1)])]),s(D)],1)},ze=[],Ye=i(He,We,ze,!1,null,"928109c9",null,null);const Qe=Ye.exports;export{Qe as default};
