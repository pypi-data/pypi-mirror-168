(self.webpackChunkpaper_admin=self.webpackChunkpaper_admin||[]).push([[9434],{7758:function(){window.addEventListener("keydown",(e=>{if(!e.defaultPrevented&&e.ctrlKey){const t=document.querySelector(".paper-pagination");if(!t)return;switch(e.key){case"Left":case"ArrowLeft":t.querySelector('.page-link[aria-label="Previous"]').click();break;case"Right":case"ArrowRight":t.querySelector('.page-link[aria-label="Next"]').click();break;default:return}e.preventDefault()}}))},423:function(e,t,n){"use strict";n.r(t);var s=n(1474);function o(e){this._buildTree(e)}o.prototype._createNode=function(e){const t=e.dataset;return{pk:parseInt(t.id),parent:parseInt(t.parent),element:e,childs:[]}},o.prototype._addNode=function(e){return!(!e||"number"!=typeof e.pk)&&(this._nodes[e.pk]=e,isNaN(e.parent)&&this._roots.push(e),!0)},o.prototype.getNode=function(e){if(null===this._nodes)throw new Error("tree is empty");if(!(e in this._nodes))throw new Error(`node ${e} not found`);return this._nodes[e]},o.prototype._buildTree=function(e){const t=[];this._nodes={},this._roots=[],e.forEach(function(e){const n=this._createNode(e);for(this._addNode(n);t.length;){const e=t[0];if(n.parent===e.pk)return e.childs.push(n.pk),void t.unshift(n);t.shift()}t.unshift(n)}.bind(this))},o.prototype.getRoots=function(){if(null===this._roots)throw new Error("tree is empty");return this._roots.map(function(e){return e.element}.bind(this))},o.prototype.getDescendants=function(e){return this.getNode(e).childs.reduce(function(e,t){const n=this.getNode(t);return n&&(e.push(n.element),e=e.concat(this.getDescendants(t))),e}.bind(this),[])};var r=o;function a(e,t){if(this.opts=Object.assign({url:null,tree:!1,handler:".handler",disabledClass:"disabled"},t),this.table=e,this.tbody=e.querySelector("tbody"),!this.tbody)throw new Error("table body not found");this.tree=null,this._createSortable()}a.prototype._createSortable=function(){return s.ZP.create(this.tbody,{animation:0,draggable:"tr",handle:this.opts.handler,filter:function(e,t,n){if(t.classList.contains(this.opts.disabledClass))return!0;const s=t.querySelector(this.opts.handler);return!(!s||!s.classList.contains(this.opts.disabledClass))||void 0}.bind(this),ghostClass:"sortable-ghost",onStart:this._onStart.bind(this),onMove:this._onMove.bind(this),onEnd:this._onEnd.bind(this)})},a.prototype._onStart=function(e){const t=this.tbody.querySelectorAll("tr");this.opts.tree&&(this.tree=new r(t));const n=parseInt(e.item.dataset.parent);t.forEach(function(e){const t=parseInt(e.dataset.parent);isNaN(t)&&isNaN(n)||t===n||e.classList.add(this.opts.disabledClass)}.bind(this))},a.prototype._onMove=function(e){return!e.related.classList.contains(this.opts.disabledClass)},a.prototype._onEnd=function(e){this.tbody.querySelectorAll("tr").forEach((e=>{e.classList.remove(this.opts.disabledClass)}));const t=this._getMovedRows(e);if(!t.length||1===t.length)return;this._normalizeTable(e,t);const n=this._createOrderMap(e,t),s=this.tbody.querySelectorAll(this.opts.handler);s.forEach((e=>{e.classList.add(this.opts.disabledClass)})),this._sendRequest(n).then((()=>{s.forEach((e=>{e.classList.remove(this.opts.disabledClass)}))}))},a.prototype._getMovedRows=function(e){const t=Math.min(e.oldIndex,e.newIndex),n=Math.max(e.oldIndex,e.newIndex),s=this.tbody.querySelectorAll("tr");let o=Array.prototype.slice.call(s,t,n+1);if(this.tree){const t=parseInt(e.item.dataset.id),n=this.tree.getNode(t);o=o.filter((e=>parseInt(e.dataset.parent)===n.parent))}return o},a.prototype._createOrderMap=function(e,t){const n=[],s=[];t.forEach((e=>{e.querySelector(this.opts.handler)&&(n.push(parseInt(e.dataset.id)),s.push(parseInt(e.dataset.orderValue)))}));return e.oldIndex<e.newIndex?s.unshift(s.pop()):s.push(s.shift()),n.reduce(((e,t,n)=>{e[t]=s[n];return this.tbody.querySelector("tr[data-id='"+t+"']").setAttribute("data-order-value",s[n]),e}),{})},a.prototype._normalizeTable=function(e,t){if(this.tree){const n=parseInt(e.item.dataset.id),s=this.tree.getNode(n),o=e.item.previousElementSibling,r=e.item.nextElementSibling,a=t.slice();if(o&&r){const e=parseInt(o.dataset.parent)===s.parent,t=parseInt(r.dataset.parent)===parseInt(o.dataset.id);e&&t&&!a.includes(o)&&a.unshift(o)}a.forEach((e=>{const t=parseInt(e.dataset.id),n=this.tree.getDescendants(t);Element.prototype.after.apply(e,n)}))}},a.prototype._sendRequest=function(e){return fetch(this.opts.url,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(!e.ok){const t=new Error(`${e.status} ${e.statusText}`);throw t.response=e,t}}))};var c=a,i=n(4027);const l="action-toggle",d="paper-actions__counter",u="paper-actions__question",h="paper-actions__all",p="paper-actions__clear";function f(e,t){e.forEach((e=>{e&&"TR"===e.tagName&&e.dispatchEvent(new CustomEvent("select",{bubbles:!0,cancelable:!0,detail:{state:t}}))}))}function y(e){const t=e.reduce(((e,t)=>e+(t.checked?1:0)),0);document.querySelectorAll(`.${d}`).forEach((e=>{e.innerHTML=interpolate(ngettext("%(sel)s of %(cnt)s selected","%(sel)s of %(cnt)s selected",t),{sel:t,cnt:e.dataset.actionsIcnt},!0)})),t===e.length?document.querySelectorAll(`.${u}`).forEach((e=>{e.hidden=!1})):g(e)}function m(e){document.querySelectorAll(".paper-actions__select_across input.select-across").forEach((t=>{t.value=Number(e)}))}function g(e){m(!1);document.querySelectorAll(`.${d}`).forEach((e=>{e.hidden=!1}));document.querySelectorAll(`.${h}`).forEach((e=>{e.hidden=!0}));const t=e.reduce(((e,t)=>e+(t.checked?1:0)),0);document.querySelectorAll(`.${u}`).forEach((n=>{n.hidden=t!==e.length}));document.querySelectorAll(`.${p}`).forEach((e=>{e.hidden=!0}))}const b=document.querySelectorAll(".action-select");b.length&&function(e){let t=null;const n=document.getElementById("result_list"),s=document.getElementById(l);s.addEventListener("change",(()=>{const t=e.map((e=>e.closest("tr")));f(t,s.checked),y(e)})),n.addEventListener("select",(t=>{const o=t.target;if("TR"!==o.tagName||o.closest("table")!==n)return;const r=Boolean(t.detail.state);o.querySelector(".action-select").checked=r,o.classList.toggle("selected",r),s.checked=null==e.find((e=>!e.checked))})),n.addEventListener("click",(n=>{const s=n.target,o=s.closest("tr");if(!o)return;const r=s.closest(".action-checkbox .custom-control"),a=o.querySelector(".action-select");if(n.shiftKey&&t){const n=e.indexOf(t),s=e.indexOf(a),o=Math.min(n,s),r=Math.max(n,s),c=e.slice(o,r+1).map((e=>e.closest("tr")));f(c,t.checked)}else(r||n.ctrlKey&&!n.shiftKey)&&(t=a,f([o],!a.checked));y(e)})),n.addEventListener("mousedown",(e=>{const t=e.target;!e.shiftKey||"TD"!==t.tagName&&"TH"!==t.tagName||e.preventDefault()})),document.addEventListener("click",(e=>{const t=e.target;"A"===t.tagName&&t.closest(`.${u}`)&&(e.preventDefault(),m(!0),document.querySelectorAll(`.${d}`).forEach((e=>{e.hidden=!0})),document.querySelectorAll(`.${h}`).forEach((e=>{e.hidden=!1})),document.querySelectorAll(`.${u}`).forEach((e=>{e.hidden=!0})),document.querySelectorAll(`.${p}`).forEach((e=>{e.hidden=!1})))})),document.addEventListener("click",(t=>{const n=t.target;if("A"===n.tagName&&n.closest(`.${p}`)){t.preventDefault(),s.checked=!1;const n=e.map((e=>e.closest("tr")));f(n,!1),g(e),y(e)}})),function(){let e=!1;document.getElementById("changelist-form").addEventListener("change",(t=>{const n=t.target;"INPUT"===n.tagName?n.closest(".action-select")||n.id===l||(e=!0):"SELECT"===n.tagName&&n.closest(".action-action")||(e=!0)})),document.addEventListener("click",(t=>{t.target.closest('[name="index"]')&&e&&(confirm(gettext("You have unsaved changes on individual editable fields. If you run an action, your unsaved changes will be lost."))||t.preventDefault())})),document.addEventListener("click",(t=>{const n=t.target.closest('[name="_save"]'),s=document.querySelectorAll('.actions select[name="action"]'),o=!Array.prototype.every.call(s,(e=>!e.value));if(n&&o){let n;n=e?confirm(gettext("You have selected an action, but you haven't saved your changes to individual fields yet. Please click OK to save. You'll need to re-run the action.")):confirm(gettext("You have selected an action, and you haven't made any changes on individual fields. You're probably looking for the Go button rather than the Save button.")),n||t.preventDefault()}}))}()}(Array.from(b));n(7758);const _=document.querySelector(".paper-search-form"),v=_&&_.querySelector(".form-control");v&&v.addEventListener("focus",(()=>{v.select()}));var E=n(1976),S=n(6410),k=n(5932);class w extends k.Z{constructor(e){super(),this.opts=Object.assign({altInput:!0,locale:this._getLocale(),dateFormat:this._getDateFormat()},e)}_init(e){const t=e.querySelector("[data-range-start]"),n=Object.assign({},this.opts);(0,E.Gn)(t,n);const s=e.querySelector("[data-range-end]"),o=Object.assign({},this.opts);(0,E.Gn)(s,o),e.addEventListener("click",(e=>{const t=e.target.closest("[data-today]");if(t){const e=t.closest(".input-group"),n=e&&e.querySelector("input");n&&n._flatpickr&&n._flatpickr.setDate("today")}}))}_destroy(e){const t=e.querySelector("[data-range-start]");t._flatpickr&&t._flatpickr.destroy();const n=e.querySelector("[data-range-end]");n._flatpickr&&n._flatpickr.destroy()}_getLocale(){for(const e of(0,S.Z)())if(E.Gn.l10ns[e])return e;return"default"}_getDateFormat(){for(const e of(0,S.Z)())if(E.fK[e])return E.fK[e];return"Y-m-d"}}const q=new w;q.observe(".paper-date-range-filter"),q.initAll(".paper-date-range-filter");const A=new i.C({width:"100%",allowClear:!0,containerCssClass:"select2-container--small"});A.observe(".paper-select2-filter select"),A.initAll(".paper-select2-filter select");const L=new i.C({width:"",allowClear:!0,containerCssClass:"select2-container--small"});L.observe(".paper-table .select-field select"),L.initAll(".paper-table .select-field select");const I=new i.C({allowClear:!0,containerCssClass:"select2-container--small",minimumResultsForSearch:1/0});I.observe(".paper-actions select"),I.initAll(".paper-actions select");const N=document.getElementById("result_list");N&&N.classList.contains("paper-table--sortable")&&new c(N,{url:N.dataset.orderUrl,tree:N.classList.contains("paper-table--tree"),handler:".paper-table__sort-handler"})}}]);
//# sourceMappingURL=changelist.d1d415040503e05d8158.js.map